(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[312],{9191:function(e,t,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/blog-editor",function(){return o(699)}])},699:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return a}});var r=o(5893),i=o(7294),l=o(1163),n=o(9008),s=o.n(n);function a(){let e=(0,l.useRouter)(),{id:t}=e.query,[o,n]=(0,i.useState)(""),[a,d]=(0,i.useState)(null),[c,p]=(0,i.useState)(""),[x,u]=(0,i.useState)(""),[g,f]=(0,i.useState)(""),[h,b]=(0,i.useState)(""),[m,y]=(0,i.useState)(""),[j,v]=(0,i.useState)(""),[S,w]=(0,i.useState)({slot1:"",slot2:"",slot3:"",slot4:"",slot5:""}),[C,k]=(0,i.useState)(!0),[z,D]=(0,i.useState)(!1),[B,_]=(0,i.useState)(null);(0,i.useEffect)(()=>{let o=localStorage.getItem("admin_token");if(!o){e.push("/admin");return}n(o),t?R(o,t):k(!1)},[t]);let R=async(e,t)=>{try{let s=await fetch("/api/admin/blog-edit?id=".concat(t),{headers:{Authorization:"Bearer ".concat(e)}}),a=await s.json();if(a.success){var o,r,i,l,n;let e=a.data;d(e),p(e.title||""),u(e.slug||""),f(e.content||""),b(e.excerpt||""),y(e.tags?e.tags.join(", "):""),v(e.cover_image_url||""),w({slot1:(null===(o=e.image_slots)||void 0===o?void 0:o.slot1)||"",slot2:(null===(r=e.image_slots)||void 0===r?void 0:r.slot2)||"",slot3:(null===(i=e.image_slots)||void 0===i?void 0:i.slot3)||"",slot4:(null===(l=e.image_slots)||void 0===l?void 0:l.slot4)||"",slot5:(null===(n=e.image_slots)||void 0===n?void 0:n.slot5)||""})}}catch(e){console.error("获取博客详情失败:",e)}finally{k(!1)}},W=async e=>{let t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=async t=>{let o=t.target.files[0];if(o){let t=new FileReader;t.onloadend=async()=>{await F(e,t.result)},t.readAsDataURL(o)}},t.click()},F=async(e,r)=>{_(e);try{let i=await fetch("/api/admin/blog-upload-slot",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify({blogId:t,slotName:e,imageData:r})}),l=await i.json();l.success?(w({...S,[e]:l.data.imageUrl}),alert("".concat(e," 图片上传成功！"))):alert("上传失败: ".concat(l.error))}catch(e){console.error("上传失败:",e),alert("上传失败，请重试")}finally{_(null)}},T=async()=>{if(!c.trim()||!g.trim()){alert("请填写标题和内容");return}D(!0);try{let r=t?"/api/admin/blog-edit":"/api/admin/blog-upload",i=t?"PUT":"POST",l=t?{id:t,title:c.trim(),slug:x.trim(),content:g.trim(),excerpt:h.trim(),tags:m,cover_image_url:j,image_slots:S}:{title:c.trim(),content:g.trim(),tags:m,file:j,image_slots:S},n=await fetch(r,{method:i,headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify(l)}),s=await n.json();s.success?(alert(t?"博客更新成功！":"博客创建成功！"),!t&&s.data.blog?e.push("/admin/blog-editor?id=".concat(s.data.blog.id)):d(s.data)):alert("保存失败: ".concat(s.error))}catch(e){console.error("保存失败:",e),alert("保存失败，请重试")}finally{D(!1)}},P=e=>e.toLowerCase().replace(/[^a-z0-9\u4e00-\u9fa5]+/g,"-").replace(/^-+|-+$/g,"");return C?(0,r.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",fontSize:"18px"},children:"加载中..."}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s(),{children:[(0,r.jsxs)("title",{children:[t?"编辑博客":"新建博客"," - PawSafePlants"]}),(0,r.jsx)("meta",{name:"description",content:"博客编辑器"})]}),(0,r.jsxs)("div",{style:{maxWidth:"1400px",margin:"0 auto",padding:"20px",fontFamily:"system-ui, -apple-system, sans-serif"},children:[(0,r.jsxs)("div",{style:{marginBottom:"30px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{style:{fontSize:"32px",fontWeight:"600",color:"#2d3748",marginBottom:"8px"},children:t?"✏️ 编辑博客":"➕ 新建博客"}),(0,r.jsx)("p",{style:{color:"#718096",fontSize:"16px"},children:t?"编辑博客文章和图片槽位":"创建新的博客文章"})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:"12px"},children:[t&&x&&(0,r.jsx)(Link,{href:"/blog/".concat(x),target:"_blank",children:(0,r.jsx)("button",{style:{padding:"12px 24px",background:"#10b981",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"500",cursor:"pointer",transition:"background-color 0.2s"},children:"\uD83D\uDC41️ 预览博客"})}),(0,r.jsx)(Link,{href:"/admin/blog-table",children:(0,r.jsx)("button",{style:{padding:"12px 24px",background:"#6b7280",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"500",cursor:"pointer",transition:"background-color 0.2s"},children:"\uD83D\uDCDD 博客列表"})})]})]}),(0,r.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:"30px"},children:[(0,r.jsx)("div",{children:(0,r.jsxs)("div",{style:{background:"#ffffff",borderRadius:"12px",padding:"30px",marginBottom:"30px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.07)",border:"1px solid #e2e8f0"},children:[(0,r.jsx)("h2",{style:{fontSize:"24px",fontWeight:"600",color:"#2d3748",marginBottom:"25px"},children:"\uD83D\uDCDD 基本信息"}),(0,r.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,r.jsx)("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#4a5568",marginBottom:"8px"},children:"博客标题 *"}),(0,r.jsx)("input",{type:"text",value:c,onChange:e=>{let o=e.target.value;p(o),t||x||u(P(o))},placeholder:"请输入博客标题",style:{width:"100%",padding:"12px 16px",border:"2px solid #e2e8f0",borderRadius:"8px",fontSize:"16px",outline:"none",transition:"border-color 0.2s"},onFocus:e=>{e.target.style.borderColor="#4299e1"},onBlur:e=>{e.target.style.borderColor="#e2e8f0"}})]}),(0,r.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,r.jsx)("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#4a5568",marginBottom:"8px"},children:"URL Slug *"}),(0,r.jsx)("input",{type:"text",value:x,onChange:e=>u(e.target.value),placeholder:"url-friendly-slug",style:{width:"100%",padding:"12px 16px",border:"2px solid #e2e8f0",borderRadius:"8px",fontSize:"16px",fontFamily:"monospace",outline:"none",transition:"border-color 0.2s"},onFocus:e=>{e.target.style.borderColor="#4299e1"},onBlur:e=>{e.target.style.borderColor="#e2e8f0"}}),(0,r.jsxs)("div",{style:{fontSize:"12px",color:"#718096",marginTop:"4px"},children:["访问地址: /blog/",x||"url-slug"]})]}),(0,r.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,r.jsx)("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#4a5568",marginBottom:"8px"},children:"内容摘要"}),(0,r.jsx)("textarea",{value:h,onChange:e=>b(e.target.value),placeholder:"简短的内容摘要，用于列表显示",rows:3,style:{width:"100%",padding:"12px 16px",border:"2px solid #e2e8f0",borderRadius:"8px",fontSize:"14px",lineHeight:"1.5",outline:"none",transition:"border-color 0.2s",resize:"vertical"},onFocus:e=>{e.target.style.borderColor="#4299e1"},onBlur:e=>{e.target.style.borderColor="#e2e8f0"}})]}),(0,r.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,r.jsx)("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#4a5568",marginBottom:"8px"},children:"标签 (用逗号分隔)"}),(0,r.jsx)("input",{type:"text",value:m,onChange:e=>y(e.target.value),placeholder:"例如: 猫咪, 植物, 安全",style:{width:"100%",padding:"12px 16px",border:"2px solid #e2e8f0",borderRadius:"8px",fontSize:"16px",outline:"none",transition:"border-color 0.2s"},onFocus:e=>{e.target.style.borderColor="#4299e1"},onBlur:e=>{e.target.style.borderColor="#e2e8f0"}})]}),(0,r.jsxs)("div",{style:{marginBottom:"25px"},children:[(0,r.jsx)("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#4a5568",marginBottom:"8px"},children:"封面图片"}),(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{let t=e.target.files[0];if(t){let e=new FileReader;e.onloadend=()=>{v(e.result)},e.readAsDataURL(t)}},style:{width:"100%",padding:"10px",border:"2px dashed #cbd5e0",borderRadius:"8px",background:"#f7fafc",cursor:"pointer"}}),j&&(0,r.jsxs)("div",{style:{marginTop:"15px"},children:[(0,r.jsx)("img",{src:j,alt:"封面预览",style:{maxWidth:"200px",maxHeight:"150px",borderRadius:"8px",border:"1px solid #e2e8f0"}}),(0,r.jsx)("button",{onClick:()=>v(""),style:{marginLeft:"10px",padding:"6px 12px",background:"#e53e3e",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"删除图片"})]})]}),(0,r.jsxs)("div",{style:{marginBottom:"25px"},children:[(0,r.jsx)("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#4a5568",marginBottom:"8px"},children:"博客内容 *"}),(0,r.jsx)("textarea",{value:g,onChange:e=>f(e.target.value),placeholder:"请输入博客内容（支持Markdown格式）",rows:15,style:{width:"100%",padding:"12px 16px",border:"2px solid #e2e8f0",borderRadius:"8px",fontSize:"16px",lineHeight:"1.6",outline:"none",transition:"border-color 0.2s",resize:"vertical"},onFocus:e=>{e.target.style.borderColor="#4299e1"},onBlur:e=>{e.target.style.borderColor="#e2e8f0"}})]}),(0,r.jsx)("button",{onClick:T,disabled:z||!c.trim()||!g.trim()||!x.trim(),style:{padding:"14px 28px",background:!z&&c.trim()&&g.trim()&&x.trim()?"#4299e1":"#cbd5e0",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"500",cursor:!z&&c.trim()&&g.trim()&&x.trim()?"pointer":"not-allowed",transition:"background-color 0.2s"},children:z?"保存中...":"\uD83D\uDCBE 保存博客"})]})}),(0,r.jsx)("div",{children:(0,r.jsxs)("div",{style:{background:"#ffffff",borderRadius:"12px",padding:"20px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.07)",border:"1px solid #e2e8f0"},children:[(0,r.jsx)("h3",{style:{fontSize:"20px",fontWeight:"600",color:"#2d3748",marginBottom:"20px"},children:"\uD83D\uDDBC️ 图片槽位 (5个)"}),(0,r.jsx)("div",{style:{display:"grid",gap:"16px"},children:Object.entries(S).map((e,t)=>{let[o,i]=e;return(0,r.jsxs)("div",{style:{padding:"16px",border:"1px solid #e2e8f0",borderRadius:"8px",background:"#fafafa"},children:[(0,r.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:(0,r.jsxs)("h4",{style:{fontSize:"16px",fontWeight:"600",color:"#2d3748",margin:0},children:["槽位 ",t+1," (",o,")"]})}),i?(0,r.jsxs)("div",{children:[(0,r.jsx)("img",{src:i,alt:o,style:{width:"100%",height:"120px",objectFit:"cover",borderRadius:"6px",marginBottom:"8px"}}),(0,r.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,r.jsx)("button",{onClick:()=>W(o),disabled:B===o,style:{flex:1,padding:"8px 12px",background:B===o?"#cbd5e0":"#4299e1",color:"white",border:"none",borderRadius:"4px",fontSize:"12px",cursor:B===o?"not-allowed":"pointer"},children:B===o?"上传中...":"\uD83D\uDD04 更换"}),(0,r.jsx)("button",{onClick:()=>w({...S,[o]:""}),style:{padding:"8px 12px",background:"#ef4444",color:"white",border:"none",borderRadius:"4px",fontSize:"12px",cursor:"pointer"},children:"删除"})]})]}):(0,r.jsx)("button",{onClick:()=>W(o),disabled:B===o,style:{width:"100%",padding:"12px",background:B===o?"#cbd5e0":"#e53e3e",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",cursor:B===o?"not-allowed":"pointer"},children:B===o?"上传中...":"\uD83D\uDCE4 上传图片"})]},o)})}),(0,r.jsxs)("div",{style:{marginTop:"20px",padding:"12px",backgroundColor:"#f0f9ff",border:"1px solid #bae6fd",borderRadius:"6px"},children:[(0,r.jsx)("div",{style:{fontSize:"12px",color:"#0369a1",fontWeight:"500",marginBottom:"4px"},children:"\uD83D\uDCA1 使用说明"}),(0,r.jsxs)("div",{style:{fontSize:"11px",color:"#0c4a6e",lineHeight:"1.4"},children:["• 5个独立图片槽位",(0,r.jsx)("br",{}),"• 上传后自动存储到image_slots",(0,r.jsx)("br",{}),"• 前端可通过blog.image_slots.slot1访问",(0,r.jsx)("br",{}),"• 支持JPG、PNG、WebP格式"]})]})]})})]})]})]})}},1163:function(e,t,o){e.exports=o(6036)}},function(e){e.O(0,[888,774,179],function(){return e(e.s=9191)}),_N_E=e.O()}]);