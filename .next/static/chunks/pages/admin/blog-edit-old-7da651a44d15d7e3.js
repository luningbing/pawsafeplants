(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[16],{8576:function(e,t,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/blog-edit-old",function(){return o(187)}])},187:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return s}});var i=o(5893),r=o(7294),n=o(1163),l=o(9008),a=o.n(l);function s(){let e=(0,n.useRouter)(),{id:t}=e.query,[o,l]=(0,r.useState)(""),[s,d]=(0,r.useState)(null),[p,c]=(0,r.useState)(""),[x,u]=(0,r.useState)(""),[g,h]=(0,r.useState)(""),[f,m]=(0,r.useState)(""),[b,y]=(0,r.useState)([]),[j,w]=(0,r.useState)(!0),[S,v]=(0,r.useState)(!1),[C,B]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let o=localStorage.getItem("admin_token");if(!o){e.push("/admin");return}l(o),t&&k(o,t)},[t]);let k=async(e,t)=>{try{let o=await fetch("/api/admin/blog-edit?id=".concat(t),{headers:{Authorization:"Bearer ".concat(e)}}),i=await o.json();if(i.success){let e=i.data;d(e),c(e.title||""),u(e.content||""),h(e.tags?e.tags.join(", "):""),m(e.cover_image_url||""),y(e.gallery_images||[])}}catch(e){console.error("获取博客详情失败:",e)}finally{w(!1)}},z=async(e,t,o)=>{let i=document.createElement("input");i.type="file",i.accept="image/*",i.onchange=async i=>{let r=i.target.files[0];if(r){let i=new FileReader;i.onloadend=async()=>{await _(e,t,o,i.result)},i.readAsDataURL(r)}},i.click()},_=async(e,i,r,n)=>{B(e);try{let l=await fetch("/api/admin/blog-edit",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify({blogId:t,position:e,title:i,description:r,file:n})}),a=await l.json();a.success?(alert("".concat(i," 图片上传成功！")),y(a.data.gallery)):alert("上传失败: ".concat(a.error))}catch(e){console.error("上传失败:",e),alert("上传失败，请重试")}finally{B(null)}},D=async()=>{if(!p.trim()||!x.trim()){alert("请填写标题和内容");return}v(!0);try{let e=await fetch("/api/admin/blog-edit",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify({id:t,title:p.trim(),content:x.trim(),tags:g,cover_image_url:f})}),i=await e.json();i.success?(alert("博客保存成功！"),d(i.data)):alert("保存失败: ".concat(i.error))}catch(e){console.error("保存失败:",e),alert("保存失败，请重试")}finally{v(!1)}};return j?(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",fontSize:"18px"},children:"加载中..."}):s?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(a(),{children:[(0,i.jsx)("title",{children:"编辑博客 - PawSafePlants"}),(0,i.jsx)("meta",{name:"description",content:"编辑博客文章"})]}),(0,i.jsxs)("div",{style:{maxWidth:"1200px",margin:"0 auto",padding:"20px",fontFamily:"system-ui, -apple-system, sans-serif"},children:[(0,i.jsxs)("div",{style:{marginBottom:"40px",textAlign:"center"},children:[(0,i.jsx)("h1",{style:{fontSize:"32px",fontWeight:"600",color:"#2d3748",marginBottom:"10px"},children:"✏️ 编辑博客"}),(0,i.jsx)("p",{style:{color:"#718096",fontSize:"16px"},children:"编辑博客文章和画廊图片"})]}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:"30px"},children:[(0,i.jsx)("div",{children:(0,i.jsxs)("div",{style:{background:"#ffffff",borderRadius:"12px",padding:"30px",marginBottom:"30px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.07)",border:"1px solid #e2e8f0"},children:[(0,i.jsx)("h2",{style:{fontSize:"24px",fontWeight:"600",color:"#2d3748",marginBottom:"25px"},children:"\uD83D\uDCDD 基本信息"}),(0,i.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#4a5568",marginBottom:"8px"},children:"博客标题 *"}),(0,i.jsx)("input",{type:"text",value:p,onChange:e=>c(e.target.value),placeholder:"请输入博客标题",style:{width:"100%",padding:"12px 16px",border:"2px solid #e2e8f0",borderRadius:"8px",fontSize:"16px",outline:"none",transition:"border-color 0.2s"},onFocus:e=>{e.target.style.borderColor="#4299e1"},onBlur:e=>{e.target.style.borderColor="#e2e8f0"}})]}),(0,i.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#4a5568",marginBottom:"8px"},children:"标签 (用逗号分隔)"}),(0,i.jsx)("input",{type:"text",value:g,onChange:e=>h(e.target.value),placeholder:"例如: 猫咪, 植物, 安全",style:{width:"100%",padding:"12px 16px",border:"2px solid #e2e8f0",borderRadius:"8px",fontSize:"16px",outline:"none",transition:"border-color 0.2s"},onFocus:e=>{e.target.style.borderColor="#4299e1"},onBlur:e=>{e.target.style.borderColor="#e2e8f0"}})]}),(0,i.jsxs)("div",{style:{marginBottom:"25px"},children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#4a5568",marginBottom:"8px"},children:"封面图片"}),(0,i.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{let t=e.target.files[0];if(t){let e=new FileReader;e.onloadend=()=>{m(e.result)},e.readAsDataURL(t)}},style:{width:"100%",padding:"10px",border:"2px dashed #cbd5e0",borderRadius:"8px",background:"#f7fafc",cursor:"pointer"}}),f&&(0,i.jsxs)("div",{style:{marginTop:"15px"},children:[(0,i.jsx)("img",{src:f,alt:"封面预览",style:{maxWidth:"200px",maxHeight:"150px",borderRadius:"8px",border:"1px solid #e2e8f0"}}),(0,i.jsx)("button",{onClick:()=>m(""),style:{marginLeft:"10px",padding:"6px 12px",background:"#e53e3e",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"删除图片"})]})]}),(0,i.jsxs)("div",{style:{marginBottom:"25px"},children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#4a5568",marginBottom:"8px"},children:"博客内容 *"}),(0,i.jsx)("textarea",{value:x,onChange:e=>u(e.target.value),placeholder:"请输入博客内容（支持Markdown格式）",rows:15,style:{width:"100%",padding:"12px 16px",border:"2px solid #e2e8f0",borderRadius:"8px",fontSize:"16px",lineHeight:"1.6",outline:"none",transition:"border-color 0.2s",resize:"vertical"},onFocus:e=>{e.target.style.borderColor="#4299e1"},onBlur:e=>{e.target.style.borderColor="#e2e8f0"}})]}),(0,i.jsx)("button",{onClick:D,disabled:S||!p.trim()||!x.trim(),style:{padding:"14px 28px",background:!S&&p.trim()&&x.trim()?"#4299e1":"#cbd5e0",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"500",cursor:!S&&p.trim()&&x.trim()?"pointer":"not-allowed",transition:"background-color 0.2s"},children:S?"保存中...":"\uD83D\uDCBE 保存博客"})]})}),(0,i.jsx)("div",{children:(0,i.jsxs)("div",{style:{background:"#ffffff",borderRadius:"12px",padding:"20px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.07)",border:"1px solid #e2e8f0"},children:[(0,i.jsx)("h3",{style:{fontSize:"20px",fontWeight:"600",color:"#2d3748",marginBottom:"20px"},children:"\uD83D\uDCF8 画廊图片"}),[{position:"the_ring_bearer",title:"The Ring Bearer",description:"小猫咪戴着求婚戒指，准备见证主人的浪漫时刻"},{position:"flower_crown",title:"Flower Crown",description:"猫咪戴着花冠，成为情人节最可爱的见证者"},{position:"proposal_moment",title:"Proposal Moment",description:"在浪漫的求婚瞬间，猫咪静静陪伴在旁"},{position:"celebration_hug",title:"Celebration Hug",description:"求婚成功后，与猫咪一起庆祝这个特殊时刻"}].map((e,t)=>{let o=b.find(t=>t.position===e.position);return(0,i.jsxs)("div",{style:{marginBottom:"20px",padding:"15px",border:"1px solid #e2e8f0",borderRadius:"8px",background:"#fafafa"},children:[(0,i.jsx)("h4",{style:{fontSize:"16px",fontWeight:"600",color:"#2d3748",marginBottom:"8px"},children:e.title}),(0,i.jsx)("p",{style:{fontSize:"12px",color:"#718096",marginBottom:"12px",lineHeight:"1.4"},children:e.description}),o?(0,i.jsxs)("div",{children:[(0,i.jsx)("img",{src:o.url,alt:o.title,style:{width:"100%",height:"120px",objectFit:"cover",borderRadius:"6px",marginBottom:"10px"}}),(0,i.jsx)("div",{style:{display:"flex",gap:"8px"},children:(0,i.jsx)("button",{onClick:()=>z(e.position,e.title,e.description),disabled:C===e.position,style:{flex:1,padding:"8px 12px",background:C===e.position?"#cbd5e0":"#4299e1",color:"white",border:"none",borderRadius:"4px",fontSize:"12px",cursor:C===e.position?"not-allowed":"pointer"},children:C===e.position?"上传中...":"\uD83D\uDD04 更换"})})]}):(0,i.jsx)("button",{onClick:()=>z(e.position,e.title,e.description),disabled:C===e.position,style:{width:"100%",padding:"12px",background:C===e.position?"#cbd5e0":"#e53e3e",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",cursor:C===e.position?"not-allowed":"pointer"},children:C===e.position?"上传中...":"\uD83D\uDCE4 上传图片"})]},e.position)})]})})]})]})]}):(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",fontSize:"18px"},children:"博客不存在"})}},1163:function(e,t,o){e.exports=o(6036)}},function(e){e.O(0,[888,774,179],function(){return e(e.s=8576)}),_N_E=e.O()}]);