(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[223],{1632:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/setup-blog-db",function(){return n(1648)}])},1648:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return a}});var o=n(5893),i=n(7294),r=n(9008),l=n.n(r);function a(){let[e,t]=(0,i.useState)(!1),[n,r]=(0,i.useState)(""),[a,s]=(0,i.useState)(""),[d,c]=(0,i.useState)(""),[p,x]=(0,i.useState)(""),u=async()=>{if(!a||!d){r("❌ 请输入用户名和密码");return}t(!0),r("正在登录...");try{let e=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:a,password:d})}),t=await e.json();t.success?(x(t.token),r("✅ 登录成功！现在可以设置数据库了"),localStorage.setItem("admin_token",t.token)):r("❌ 登录失败: ".concat(t.error))}catch(e){r("❌ 登录错误: ".concat(e.message))}finally{t(!1)}},f=async()=>{if(!p){r("❌ 请先登录");return}t(!0),r("正在设置数据库...");try{r("\uD83D\uDD04 正在检查表结构并迁移数据...");let e=await fetch("/api/admin/blog-migrate-industrial",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(p)}}),t=await e.json();t.success?r("✅ 数据库设置完成！\n\n\uD83C\uDF89 博客数据已成功迁移！\n\n✅ 表结构已更新\n✅ 情人节博客已迁移\n✅ 5个图片槽位已设置\n\n请访问前台博客页面验证：\nhttps://www.pawsafeplants.com/blog/valentines-day-cat-safe-flowers-guide"):t.sql?r("⚠️ 需要手动执行SQL语句\n\n".concat(t.sql,'\n\n执行完成后，请重新点击"\uD83D\uDE80 开始设置数据库"按钮。')):r("❌ 数据迁移失败: ".concat(t.error||t.details))}catch(e){r("❌ 错误: ".concat(e.message))}finally{t(!1)}};return(0,i.useEffect)(()=>{{let e=localStorage.getItem("admin_token");e&&x(e)}},[]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(l(),{children:(0,o.jsx)("title",{children:"设置博客数据库 - PawSafePlants"})}),(0,o.jsxs)("div",{style:{maxWidth:"800px",margin:"0 auto",padding:"40px 20px",fontFamily:"system-ui, -apple-system, sans-serif"},children:[(0,o.jsx)("h1",{style:{fontSize:"32px",fontWeight:"600",color:"#2d3748",marginBottom:"20px"},children:"\uD83D\uDDC4️ 设置博客数据库"}),p?(0,o.jsxs)("div",{style:{backgroundColor:"#f0fdf4",border:"1px solid #bbf7d0",borderRadius:"8px",padding:"20px",marginBottom:"30px"},children:[(0,o.jsx)("h3",{style:{fontSize:"16px",color:"#166534",marginBottom:"10px"},children:"✅ 已登录"}),(0,o.jsx)("p",{style:{fontSize:"14px",color:"#15803d",margin:0},children:"管理员认证已完成，可以执行数据库设置操作。"})]}):(0,o.jsxs)("div",{style:{backgroundColor:"#f7fafc",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"30px",marginBottom:"30px"},children:[(0,o.jsx)("h2",{style:{fontSize:"20px",color:"#4a5568",marginBottom:"20px"},children:"\uD83D\uDD10 管理员登录"}),(0,o.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,o.jsx)("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#4a5568",marginBottom:"5px"},children:"用户名"}),(0,o.jsx)("input",{type:"text",value:a,onChange:e=>s(e.target.value),placeholder:"请输入管理员用户名",style:{width:"100%",padding:"12px 16px",border:"2px solid #e2e8f0",borderRadius:"8px",fontSize:"16px",outline:"none"}})]}),(0,o.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,o.jsx)("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#4a5568",marginBottom:"5px"},children:"密码"}),(0,o.jsx)("input",{type:"password",value:d,onChange:e=>c(e.target.value),placeholder:"请输入管理员密码",style:{width:"100%",padding:"12px 16px",border:"2px solid #e2e8f0",borderRadius:"8px",fontSize:"16px",outline:"none"}})]}),(0,o.jsx)("button",{onClick:u,disabled:e,style:{padding:"12px 24px",background:e?"#cbd5e0":"#4299e1",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"500",cursor:e?"not-allowed":"pointer"},children:e?"⏳ 登录中...":"\uD83D\uDD11 登录"})]}),(0,o.jsxs)("div",{style:{backgroundColor:"#f7fafc",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"20px",marginBottom:"30px"},children:[(0,o.jsx)("h2",{style:{fontSize:"18px",color:"#4a5568",marginBottom:"10px"},children:"\uD83D\uDCCB 执行步骤"}),(0,o.jsxs)("ol",{style:{color:"#718096",lineHeight:"1.6",paddingLeft:"20px"},children:[(0,o.jsx)("li",{children:"管理员身份验证"}),(0,o.jsx)("li",{children:"添加 slug、image_slots、excerpt 字段到 blog_posts 表"}),(0,o.jsx)("li",{children:"迁移情人节博客完整内容到数据库"}),(0,o.jsx)("li",{children:"设置5个图片槽位数据"}),(0,o.jsx)("li",{children:"验证前台博客页面显示"})]})]}),(0,o.jsx)("button",{onClick:f,disabled:e||!p,style:{padding:"16px 32px",background:e||!p?"#cbd5e0":"#4299e1",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"500",cursor:e||!p?"not-allowed":"pointer",marginBottom:"20px"},children:e?"⏳ 设置中...":"\uD83D\uDE80 开始设置数据库"}),n&&(0,o.jsx)("div",{style:{backgroundColor:n.includes("✅")?"#f0fdf4":"#fef2f2",border:"1px solid ".concat(n.includes("✅")?"#bbf7d0":"#fecaca"),borderRadius:"8px",padding:"20px",whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"14px"},children:n}),(0,o.jsxs)("div",{style:{marginTop:"40px",padding:"20px",backgroundColor:"#f0f9ff",border:"1px solid #bae6fd",borderRadius:"8px"},children:[(0,o.jsx)("h3",{style:{fontSize:"16px",color:"#0369a1",marginBottom:"10px"},children:"\uD83D\uDD17 相关链接"}),(0,o.jsxs)("div",{style:{fontSize:"14px",color:"#0c4a6e",lineHeight:"1.8"},children:[(0,o.jsxs)("div",{children:["\uD83D\uDCCA ",(0,o.jsx)("a",{href:"/admin/blog-table-test",target:"_blank",style:{color:"#0284c7"},children:"博客列表测试"})]}),(0,o.jsxs)("div",{children:["✏️ ",(0,o.jsx)("a",{href:"/admin/blog-editor-test?id=1",target:"_blank",style:{color:"#0284c7"},children:"编辑情人节博客"})]}),(0,o.jsxs)("div",{children:["\uD83D\uDCF1 ",(0,o.jsx)("a",{href:"/blog/valentines-day-cat-safe-flowers-guide",target:"_blank",style:{color:"#0284c7"},children:"前台博客页面"})]}),(0,o.jsxs)("div",{children:["\uD83C\uDFE0 ",(0,o.jsx)("a",{href:"/admin",target:"_blank",style:{color:"#0284c7"},children:"管理后台"})]})]})]})]})]})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=1632)}),_N_E=e.O()}]);