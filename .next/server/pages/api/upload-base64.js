"use strict";(()=>{var e={};e.id=4007,e.ids=[4007],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,o){return o in r?r[o]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,o)):"function"==typeof r&&"default"===o?r:void 0}}})},7115:(e,r,o)=>{o.r(r),o.d(r,{config:()=>m,default:()=>f,routeModule:()=>P});var t={};o.r(t),o.d(t,{config:()=>d,default:()=>g});var a=o(1802),s=o(7153),n=o(6249),l=o(7147),i=o.n(l),u=o(1017),c=o.n(u),p=o(2885);let d={api:{bodyParser:!1}};async function g(e,r){try{let o;if(console.log("Upload request received"),"POST"!==e.method)return console.log("Method not allowed:",e.method),r.status(405).json({error:"Method not allowed"});let t="";for await(let r of e)t+=r.toString();try{o=JSON.parse(t)}catch(e){return console.error("JSON parse error:",e),r.status(400).json({error:"Invalid JSON body"})}let a=String((o||{}).filename||"").trim().replace(/[^a-zA-Z0-9._-]/g,"_"),s=String((o||{}).data||"");if(console.log("Processing upload:",a,"Data length:",s.length),!a||!s)return console.error("Missing filename or data"),r.status(400).json({error:"Missing filename or data"});let{mime:n,buf:l}=function(e){let r=String(e||"").match(/^data:(.+?);base64,(.+)$/);return r?{mime:r[1],buf:Buffer.from(r[2],"base64")}:{mime:"",buf:Buffer.from([])}}(s);console.log("Parsed data:",{mime:n,bufferSize:l.length});let u=c().extname(a)||(n.includes("png")?".png":n.includes("svg")?".svg":n.includes("webp")?".webp":".jpg"),d=(a?a.replace(/\.[^.]+$/,""):"upload-"+Date.now())+u,g=process.env.SUPABASE_URL||"",f=process.env.SUPABASE_SERVICE_ROLE_KEY||process.env.SUPABASE_ANON_KEY||"";if(g&&f){console.log("Using Supabase storage");let e=(0,p.createClient)(g,f);try{await e.storage.createBucket("uploads",{public:!0}),console.log("Bucket created or exists")}catch(e){console.log("Bucket creation error (may already exist):",e.message)}let{error:o}=await e.storage.from("uploads").upload(d,l,{contentType:n||"application/octet-stream",upsert:!0});if(o)return console.error("Supabase upload error:",o),r.status(500).json({error:String(o.message||o)});let t="https://rczfbgzghwiqpxihlexs.supabase.co".replace(/\/$/,"")+"/storage/v1/object/public/uploads/"+d;return console.log("Upload successful:",t),r.status(200).json({path:t})}console.log("Using local filesystem storage");let m=c().join(process.cwd(),"public","uploads");try{i().existsSync(m)||(i().mkdirSync(m,{recursive:!0}),console.log("Created uploads directory:",m))}catch(e){console.error("Directory creation error:",e)}let P=c().join(m,d);return i().writeFileSync(P,l),console.log("File saved locally:",P),r.status(200).json({path:"/uploads/"+d})}catch(e){console.error("Upload handler error:",e),r.status(500).json({error:String(e?.message||e)})}}let f=(0,n.l)(t,"default"),m=(0,n.l)(t,"config"),P=new a.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/upload-base64",pathname:"/api/upload-base64",bundlePath:"",filename:""},userland:t})},7153:(e,r)=>{var o;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return o}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(o||(o={}))},1802:(e,r,o)=>{e.exports=o(145)}};var r=require("../../webpack-api-runtime.js");r.C(e);var o=r(r.s=7115);module.exports=o})();