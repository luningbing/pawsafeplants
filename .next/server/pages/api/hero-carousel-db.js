"use strict";(()=>{var e={};e.id=5798,e.ids=[5798],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,a){return a in r?r[a]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,a)):"function"==typeof r&&"default"===a?r:void 0}}})},5216:(e,r,a)=>{a.r(r),a.d(r,{config:()=>c,default:()=>d,routeModule:()=>p});var o={};a.r(o),a.d(o,{default:()=>l});var t=a(1802),s=a(7153),n=a(6249);a(7147),a(1017);var i=a(8314);async function l(e,r){try{if(console.log("Hero carousel API called:",e.method),"GET"===e.method){console.log("Reading hero carousel data from database");try{let e=(0,i.J)(),{data:a,error:o}=await e.from("hero_carousel").select("*").order("created_at",{ascending:!1}).limit(1);if(o)return console.error("Database read error:",o),r.status(200).json(u());if(!a||!(a.length>0))return console.log("No hero data found, using default"),r.status(200).json(u());{let e=a[0].content;return console.log("Found hero data in database:",e),e.slides&&Array.isArray(e.slides)&&(e.slides=e.slides.map(e=>{var r;return{...e,imageUrl:(r=function(e){if(!e)return e;if(e.startsWith("/images/plants/")){let r=e.split("/").pop();return`/uploads/${r}`}if(e.startsWith("/images/")&&!e.startsWith("/images/plants/")){let r=e.split("/").pop();return`/uploads/${r}`}return e}(e.imageUrl))?r.includes("supabase.co/storage/v1/object/public/uploads/")?(console.log("Found Supabase URL, keeping as is:",r),r):["/uploads/20250530-190020.jpg","/uploads/_247026d4-f09b-4307-9d55-65b40bd2813c.jpg","/uploads/7ae0aff1-4b60-4c05-aa34-fcd6a9ea3dd2_7930717a90c33c714f1ae8d742554593_ComfyUI_033fc57d_00001_.png"].includes(r)?r:(console.log("Invalid image path, using fallback:",r),"/images/hero-1.jpg"):"/images/hero-1.jpg"}})),console.log("Converted hero data:",e),r.status(200).json(e)}}catch(e){return console.error("Database connection error:",e),r.status(200).json(u())}}if("POST"===e.method){console.log("Saving hero carousel data to database");let{slides:a}=e.body;if(console.log("Received slides:",a),!a||!Array.isArray(a))return console.error("Invalid slides data:",a),r.status(400).json({error:"Invalid slides data"});let o=[];for(let e=0;e<3;e++){let r=a[e];o.push(r||{imageUrl:`/images/hero-${e+1}.jpg`,title:`Slide ${e+1}`,subtitle:"Default subtitle",link:""})}let t={slides:o,updatedAt:new Date().toISOString()};console.log("Hero data to save:",t);try{let{data:e,error:a}=await supabase.from("hero_carousel").select("*").order("created_at",{ascending:!1}).limit(1);if(a)return console.error("Fetch error:",a),r.status(500).json({error:"Database fetch error: "+a.message});if(e&&e.length>0){let{data:a,error:o}=await supabase.from("hero_carousel").update({content:t}).eq("id",e[0].id);if(o)return console.error("Update error:",o),r.status(500).json({error:"Database update error: "+o.message});console.log("Hero data updated successfully")}else{let{data:e,error:a}=await supabase.from("hero_carousel").insert({content:t});if(a)return console.error("Insert error:",a),r.status(500).json({error:"Database insert error: "+a.message});console.log("Hero data inserted successfully")}return r.status(200).json(t)}catch(e){return console.error("Database operation error:",e),r.status(500).json({error:"Database operation error: "+e.message})}}return r.status(405).json({error:"Method not allowed"})}catch(e){return console.error("Hero carousel API error:",e),r.status(500).json({error:"Internal server error: "+e.message})}}function u(){return{slides:[{imageUrl:"/uploads/20250530-190020.jpg",title:"Cat-Safe Plants for Your Home",subtitle:"Create a beautiful, pet-friendly living space",link:"/plants/safe"},{imageUrl:"/uploads/_247026d4-f09b-4307-9d55-65b40bd2813c.jpg",title:"Toxic Plants to Avoid",subtitle:"Protect your feline friends from harmful plants",link:"/plants/toxic"},{imageUrl:"/uploads/7ae0aff1-4b60-4c05-aa34-fcd6a9ea3dd2_7930717a90c33c714f1ae8d742554593_ComfyUI_033fc57d_00001_.png",title:"Plant Care Guide",subtitle:"Learn how to care for your green companions",link:"/plants/caution"}]}}let d=(0,n.l)(o,"default"),c=(0,n.l)(o,"config"),p=new t.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/hero-carousel-db",pathname:"/api/hero-carousel-db",bundlePath:"",filename:""},userland:o})},8314:(e,r,a)=>{a.d(r,{J:()=>t});var o=a(2885);function t(){let e="https://rczfbgzghwiqpxihlexs.supabase.co",r=process.env.SUPABASE_SERVICE_ROLE_KEY||process.env.SUPABASE_ANON_KEY;if(!e)throw console.error("CRITICAL: NEXT_PUBLIC_SUPABASE_URL or SUPABASE_URL environment variable is missing"),Error("Missing Supabase URL configuration");if(!r)throw console.error("CRITICAL: SUPABASE_SERVICE_ROLE_KEY or SUPABASE_ANON_KEY environment variable is missing"),Error("Missing Supabase Key configuration");return console.log("✅ Supabase 已连接 - URL:",e.substring(0,20)+"..."),(0,o.createClient)(e,r)}},7153:(e,r)=>{var a;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},1802:(e,r,a)=>{e.exports=a(145)}};var r=require("../../webpack-api-runtime.js");r.C(e);var a=r(r.s=5216);module.exports=a})();