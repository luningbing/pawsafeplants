"use strict";(()=>{var e={};e.id=7701,e.ids=[7701],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,s){return s in t?t[s]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,s)):"function"==typeof t&&"default"===s?t:void 0}}})},2886:(e,t,s)=>{s.r(t),s.d(t,{config:()=>h,default:()=>p,routeModule:()=>u});var o={};s.r(o),s.d(o,{default:()=>n});var r=s(1802),a=s(7153),l=s(6249),i=s(2885);async function n(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let e=(0,i.createClient)("https://rczfbgzghwiqpxihlexs.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});console.log("\uD83D\uDDBCï¸ å¼€å§‹ä¿®å¤é‡å¤Unsplashå›¾ç‰‡URL...");let{data:s,error:o}=await e.from("flowers").select("id, image_url, title");if(o)return console.error("âŒ èŽ·å–flowersæ•°æ®å¤±è´¥:",o),t.status(500).json({error:"èŽ·å–flowersæ•°æ®å¤±è´¥"});let r=[],a=new Map;s?.forEach(e=>{if(e.image_url){let t=a.get(e.image_url)||0;a.set(e.image_url,t+1)}});let l=[];a.forEach((e,t)=>{e>1&&l.push(t)}),console.log("\uD83D\uDCCA å‘çŽ°é‡å¤å›¾ç‰‡:",l);let n=["https://images.unsplash.com/photo-1558628037-f3b6c1b0c3b2?w=400&h=400&fit=crop","https://images.unsplash.com/photo-1589206912909-2896f7c45bf8?w=400&h=400&fit=crop","https://images.unsplash.com/photo-1518709594023-a7b5d2e4cf76?w=400&h=400&fit=crop","https://images.unsplash.com/photo-1459411621453-7b03977f4bfc?w=400&h=400&fit=crop","https://images.unsplash.com/photo-1506805945078-4b0c4d8d71b6?w=400&h=400&fit=crop","https://images.unsplash.com/photo-1598306948263-8e4b4898d6b5?w=400&h=400&fit=crop","https://images.unsplash.com/photo-1558628037-f3b6c1b0c3b2?w=800&h=600&fit=crop","https://images.unsplash.com/photo-1589206912909-2896f7c45bf8?w=800&h=600&fit=crop","https://images.unsplash.com/photo-1518709594023-a7b5d2e4cf76?w=800&h=600&fit=crop","https://images.unsplash.com/photo-1459411621453-7b03977f4bfc?w=800&h=600&fit=crop"],p=0;if(s?.forEach(e=>{if(l.includes(e.image_url)){let t=n[p%n.length];r.push({id:e.id,image_url:t,title:e.title}),p++,console.log(`ðŸ”„ æ›´æ–° ${e.title}: ${e.image_url} â†’ ${t}`)}}),r.length>0){let{error:s}=await e.from("flowers").upsert(r,{onConflict:"id"});if(s)return console.error("âŒ æ›´æ–°flowerså›¾ç‰‡å¤±è´¥:",s),t.status(500).json({error:"æ›´æ–°flowerså›¾ç‰‡å¤±è´¥"});console.log(`âœ… æˆåŠŸæ›´æ–° ${r.length} ä¸ªé‡å¤å›¾ç‰‡`)}let{data:h,error:u}=await e.from("atmosphere_images").select("id, url");if(u)console.error("âŒ èŽ·å–atmosphereæ•°æ®å¤±è´¥:",u);else{let t=[],s=new Map;h?.forEach(e=>{if(e.url){let t=s.get(e.url)||0;s.set(e.url,t+1)}});let o=[];s.forEach((e,t)=>{e>1&&o.push(t)});let r=0;h?.forEach(e=>{if(o.includes(e.url)){let s=n[unslashAlternatives.length-1-r%n.length];t.push({id:e.id,url:s}),r++,console.log(`ðŸ”„ æ›´æ–°atmosphere: ${e.url} â†’ ${s}`)}}),t.length>0&&(await e.from("atmosphere_images").upsert(t,{onConflict:"id"}),console.log(`âœ… æˆåŠŸæ›´æ–° ${t.length} ä¸ªatmosphereå›¾ç‰‡`))}return t.status(200).json({success:!0,message:"Unsplashå›¾ç‰‡é‡å¤é—®é¢˜ä¿®å¤å®Œæˆ",flowersFixed:r.length,atmosphereFixed:atmosphereUpdates?.length||0,duplicateImagesFound:l.length,recommendations:["æ‰€æœ‰é‡å¤å›¾ç‰‡å·²æ›¿æ¢ä¸ºå”¯ä¸€URL","å»ºè®®å®šæœŸæ£€æŸ¥å›¾ç‰‡URLæœ‰æ•ˆæ€§","è€ƒè™‘ä½¿ç”¨æœ¬åœ°å›¾ç‰‡ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆ"]})}catch(e){return console.error("âŒ ä¿®å¤Unsplashå›¾ç‰‡æ—¶å‘ç”Ÿé”™è¯¯:",e),t.status(500).json({error:"ä¿®å¤Unsplashå›¾ç‰‡å¤±è´¥",details:e.message})}}let p=(0,l.l)(o,"default"),h=(0,l.l)(o,"config"),u=new r.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/admin/fix-unsplash-images",pathname:"/api/admin/fix-unsplash-images",bundlePath:"",filename:""},userland:o})},7153:(e,t)=>{var s;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return s}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(s||(s={}))},1802:(e,t,s)=>{e.exports=s(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var s=t(t.s=2886);module.exports=s})();