"use strict";(()=>{var e={};e.id=3536,e.ids=[3536],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},8076:e=>{e.exports=require("gray-matter")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},3938:(e,t,r)=>{r.r(t),r.d(t,{config:()=>h,default:()=>f,routeModule:()=>P});var n={};r.r(n),r.d(n,{default:()=>m});var o=r(1802),a=r(7153),i=r(6249),s=r(7147),u=r.n(s),l=r(1017),c=r.n(l),p=r(8076),d=r.n(p),g=r(2885);async function m(e,t){try{if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});if(!(e.cookies&&"1"===e.cookies.psp_admin||(e.headers.cookie||"").includes("psp_admin=1")))return t.status(401).json({error:"unauthorized"});let r=process.env.SUPABASE_URL||"",n=process.env.SUPABASE_SERVICE_ROLE_KEY||process.env.SUPABASE_ANON_KEY||"";if(!r||!n)return t.status(500).json({error:"Supabase env missing",hint:["SUPABASE_URL","SUPABASE_SERVICE_ROLE_KEY"]});let o=(0,g.createClient)(r,n),a=0;try{let e=c().join(process.cwd(),"content","site.json"),t={heroImage:"",logo:""};try{t=JSON.parse(u().readFileSync(e,"utf8"))}catch{}let r=[];if(Object.prototype.hasOwnProperty.call(t,"heroImage")&&r.push({key:"heroImage",value:String(t.heroImage||"")}),Object.prototype.hasOwnProperty.call(t,"logo")&&r.push({key:"logo",value:String(t.logo||"")}),r.length){let{error:e}=await o.from("site_config").upsert(r,{onConflict:"key"});if(e)throw e;a=r.length}}catch(e){}let i=0;try{let e=c().join(process.cwd(),"content","plants"),t=[];try{t=u().readdirSync(e).filter(e=>e.endsWith(".md"))}catch{}for(let r of t){let t=c().join(e,r);try{let e=u().readFileSync(t,"utf8"),{data:r}=d()(e),n={slug:c().basename(t).replace(/\.md$/,""),image:String(r.image||""),image2:String(r.image2||""),image3:String(r.image3||""),thumbPlant:String(r.thumbPlant||""),thumbCat:String(r.thumbCat||"")},{error:a}=await o.from("plant_images").upsert(n,{onConflict:"slug"});if(a)throw a;i++}catch{}}}catch(e){}return t.status(200).json({ok:!0,site_keys:a,plants_upserted:i})}catch(e){t.status(500).json({error:String(e?.message||e)})}}let f=(0,i.l)(n,"default"),h=(0,i.l)(n,"config"),P=new o.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/admin/migrate-content",pathname:"/api/admin/migrate-content",bundlePath:"",filename:""},userland:n})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=3938);module.exports=r})();