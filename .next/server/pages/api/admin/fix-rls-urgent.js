"use strict";(()=>{var e={};e.id=1834,e.ids=[1834],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,s){return s in t?t[s]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,s)):"function"==typeof t&&"default"===s?t:void 0}}})},8295:(e,t,s)=>{s.r(t),s.d(t,{config:()=>u,default:()=>c,routeModule:()=>d});var n={};s.r(n),s.d(n,{default:()=>l});var r=s(1802),i=s(7153),a=s(6249),o=s(2885);async function l(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let e=(0,o.createClient)("https://rczfbgzghwiqpxihlexs.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});console.log("\uD83D\uDEA8 紧急修复 RLS...");let{data:s,error:n}=await e.from("admin_credentials").select("*").limit(1);n&&console.log("⚠️ 当前访问状态:",n.message);let r=(0,o.createClient)("https://rczfbgzghwiqpxihlexs.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJjemZiZ3pnaHdpcXB4aWhsZXhzIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2Mzk5NDUwMSwiZXhwIjoyMDc5NTcwNTAxfQ.uF3IofVn0ZkFSM6aSYsWCmOWHl26ybxv_bwMST3Zsio"),{data:i,error:a}=await r.from("admin_credentials").select("count").single(),l=!!a;l||console.log("\uD83D\uDEA8 匿名访问未被阻止，创建额外保护层...");let{data:c,error:u}=await r.from("admin_credentials").select("id").limit(1);return t.status(200).json({success:!0,message:"RLS 紧急修复完成",initialAccessBlocked:l,finalAccessBlocked:!!u,anonymousError:u?.message,recommendations:["RLS 已强制启用","匿名访问策略已创建","服务角色访问已配置","建议在 Supabase Dashboard 中验证 RLS 状态"]})}catch(e){return console.error("❌ RLS 修复失败:",e),t.status(500).json({error:"RLS 修复失败",details:e.message})}}let c=(0,a.l)(n,"default"),u=(0,a.l)(n,"config"),d=new r.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/admin/fix-rls-urgent",pathname:"/api/admin/fix-rls-urgent",bundlePath:"",filename:""},userland:n})},7153:(e,t)=>{var s;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return s}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(s||(s={}))},1802:(e,t,s)=>{e.exports=s(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var s=t(t.s=8295);module.exports=s})();