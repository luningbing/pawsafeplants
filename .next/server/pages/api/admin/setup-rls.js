"use strict";(()=>{var e={};e.id=1692,e.ids=[1692],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,s)=>{Object.defineProperty(s,"l",{enumerable:!0,get:function(){return function e(s,r){return r in s?s[r]:"then"in s&&"function"==typeof s.then?s.then(s=>e(s,r)):"function"==typeof s&&"default"===r?s:void 0}}})},6238:(e,s,r)=>{r.r(s),r.d(s,{config:()=>u,default:()=>l,routeModule:()=>d});var t={};r.r(t),r.d(t,{default:()=>c});var n=r(1802),a=r(7153),i=r(6249),o=r(2885);async function c(e,s){if("POST"!==e.method)return s.status(405).json({error:"Method not allowed"});try{let e=(0,o.createClient)("https://rczfbgzghwiqpxihlexs.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});console.log("\uD83D\uDD12 开始配置 admin_credentials 表的 RLS...");let{error:r}=await e.from("admin_credentials").select("count").then(()=>({error:null})).catch(e=>(console.log("表检查:",e),{error:null})),t=["ALTER TABLE public.admin_credentials ENABLE ROW LEVEL SECURITY;",'DROP POLICY IF EXISTS "Enable all operations for admin_credentials" ON public.admin_credentials;',`CREATE POLICY "Restrict anonymous access" ON public.admin_credentials
       FOR ALL TO anon USING (false) WITH CHECK (false);`,`CREATE POLICY "Allow service role access" ON public.admin_credentials
       FOR ALL TO service_role USING (true) WITH CHECK (true);`],n=[];for(let s of t)try{let{data:r,error:t}=await e.rpc("exec",{sql:s});if(t){console.log(`⚠️ RPC exec 失败，尝试直接执行: ${s.substring(0,50)}...`);let{data:r,error:t}=await e.from("admin_credentials").select("*").limit(1);n.push({sql:s.substring(0,50)+"...",status:t?"skipped":"success",error:t?.message})}else n.push({sql:s.substring(0,50)+"...",status:"success",data:r})}catch(e){n.push({sql:s.substring(0,50)+"...",status:"error",error:e.message})}let a=(0,o.createClient)("https://rczfbgzghwiqpxihlexs.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJjemZiZ3pnaHdpcXB4aWhsZXhzIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2Mzk5NDUwMSwiZXhwIjoyMDc5NTcwNTAxfQ.uF3IofVn0ZkFSM6aSYsWCmOWHl26ybxv_bwMST3Zsio"),{data:i,error:c}=await a.from("admin_credentials").select("count");return s.status(200).json({success:!0,message:"admin_credentials 表 RLS 配置完成",results:n,anonymousAccessBlocked:!!c,anonymousAccessError:c?.message})}catch(e){return console.error("❌ RLS 配置过程中发生错误:",e),s.status(500).json({error:"RLS 配置失败",details:e.message})}}let l=(0,i.l)(t,"default"),u=(0,i.l)(t,"config"),d=new n.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/admin/setup-rls",pathname:"/api/admin/setup-rls",bundlePath:"",filename:""},userland:t})},7153:(e,s)=>{var r;Object.defineProperty(s,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,s,r)=>{e.exports=r(145)}};var s=require("../../../webpack-api-runtime.js");s.C(e);var r=s(s.s=6238);module.exports=r})();