"use strict";(()=>{var e={};e.id=1022,e.ids=[1022],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,s){return s in t?t[s]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,s)):"function"==typeof t&&"default"===s?t:void 0}}})},9499:(e,t,s)=>{s.r(t),s.d(t,{config:()=>i,default:()=>u,routeModule:()=>p});var r={};s.r(r),s.d(r,{default:()=>c});var o=s(1802),n=s(7153),a=s(6249),l=s(2885);async function c(e,t){try{if(t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET, POST, OPTIONS"),t.setHeader("Access-Control-Allow-Headers","Content-Type, Authorization"),"OPTIONS"===e.method)return t.status(200).end();if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});let r=e.headers.authorization;if(!r||!r.startsWith("Bearer "))return t.status(401).json({error:"Unauthorized"});let o=r.substring(7);try{if(!s(9344).verify(o,process.env.JWT_SECRET||"your-secret-key-change-in-production").username)return t.status(401).json({error:"Invalid token"})}catch(e){return t.status(401).json({error:"Invalid token"})}let n=(0,l.createClient)("https://rczfbgzghwiqpxihlexs.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJjemZiZ3pnaHdpcXB4aWhsZXhzIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2Mzk5NDUwMSwiZXhwIjoyMDc5NTcwNTAxfQ.uF3IofVn0ZkFSM6aSYsWCmOWHl26ybxv_bwMST3Zsio",{auth:{autoRefreshToken:!1,persistSession:!1}});console.log("\uD83D\uDD04 å¼€å§‹æ›´æ–°blog_postsè¡¨ç»“æž„...");let a=["ALTER TABLE public.blog_posts ADD COLUMN IF NOT EXISTS slug text UNIQUE;","ALTER TABLE public.blog_posts ADD COLUMN IF NOT EXISTS image_slots JSONB DEFAULT '{}'::jsonb;","ALTER TABLE public.blog_posts ADD COLUMN IF NOT EXISTS excerpt text;"],c=[];for(let e=0;e<a.length;e++){let t=a[e];console.log(`ðŸ“ æ‰§è¡ŒSQL ${e+1}/${a.length}: ${t.substring(0,50)}...`);try{let{data:s,error:r}=await n.rpc("exec_sql",{sql_statement:t});r?(console.error(`âŒ SQL ${e+1} æ‰§è¡Œå¤±è´¥:`,r),c.push({statement:t,success:!1,error:r.message})):(console.log(`âœ… SQL ${e+1} æ‰§è¡ŒæˆåŠŸ`),c.push({statement:t,success:!0,data:s}))}catch(s){console.error(`âŒ SQL ${e+1} æ‰§è¡Œå¼‚å¸¸:`,s),c.push({statement:t,success:!1,error:s.message})}}console.log("\uD83D\uDD0D æ£€æŸ¥è¡¨ç»“æž„...");try{let{data:e,error:t}=await n.from("information_schema.columns").select("column_name, data_type, column_default").eq("table_name","blog_posts").eq("table_schema","public").in("column_name",["slug","image_slots","excerpt"]);t?console.error("âŒ æ£€æŸ¥è¡¨ç»“æž„å¤±è´¥:",t):console.log("âœ… è¡¨ç»“æž„æ£€æŸ¥ç»“æžœ:",e)}catch(e){console.error("âŒ æ£€æŸ¥è¡¨ç»“æž„å¼‚å¸¸:",e)}let u=c.filter(e=>e.success).length,i=c.filter(e=>!e.success).length;return console.log(`ðŸ“Š æ‰§è¡Œå®Œæˆ: ${u} æˆåŠŸ, ${i} å¤±è´¥`),t.status(200).json({success:!0,message:"Blog schema update completed",results:c,summary:{total:a.length,success:u,errors:i}})}catch(e){return console.error("\uD83D\uDEA8 Update blog schema API error:",e),t.status(500).json({error:"Internal server error",details:e.message})}}let u=(0,a.l)(r,"default"),i=(0,a.l)(r,"config"),p=new o.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/admin/update-blog-schema",pathname:"/api/admin/update-blog-schema",bundlePath:"",filename:""},userland:r})},7153:(e,t)=>{var s;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return s}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(s||(s={}))},1802:(e,t,s)=>{e.exports=s(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var s=t(t.s=9499);module.exports=s})();