"use strict";(()=>{var e={};e.id=7205,e.ids=[7205],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6705:e=>{e.exports=import("formidable")},6249:(e,a)=>{Object.defineProperty(a,"l",{enumerable:!0,get:function(){return function e(a,t){return t in a?a[t]:"then"in a&&"function"==typeof a.then?a.then(a=>e(a,t)):"function"==typeof a&&"default"===t?a:void 0}}})},6810:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.r(a),t.d(a,{config:()=>d,default:()=>u,routeModule:()=>c});var o=t(1802),s=t(7153),i=t(6249),n=t(4196),l=e([n]);n=(l.then?(await l)():l)[0];let u=(0,i.l)(n,"default"),d=(0,i.l)(n,"config"),c=new o.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/media",pathname:"/api/media",bundlePath:"",filename:""},userland:n});r()}catch(e){r(e)}})},1604:(e,a,t)=>{t.d(a,{p:()=>r});let r=(0,t(2885).createClient)("https://rczfbgzghwiqpxihlexs.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJjemZiZ3pnaHdpcXB4aWhsZXhzIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2Mzk5NDUwMDE3MDAxfQ.uF3IofVn0ZkFSM6aSYsWCmOWHl26ybxv_bwMST3Zsio")},4196:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.r(a),t.d(a,{default:()=>n});var o=t(1604),s=t(6705),i=e([s]);async function n(e,a){if("GET"!==e.method&&"POST"!==e.method)return a.status(405).json({error:"Method not allowed"});try{if(console.log("\uD83D\uDCF8 Media API request:",{method:e.method,timestamp:new Date().toISOString()}),"GET"===e.method){console.log("\uD83D\uDCCB Fetching media files from database...");let{data:e,error:t}=await o.p.from("media_metadata").select("*").order("created_at",{ascending:!1});if(t)return console.error("❌ Database error:",t),a.status(500).json({error:"Failed to fetch media files",details:t});return console.log("✅ Media files fetched:",{count:e?.length||0}),a.status(200).json({success:!0,media:e||[]})}"POST"===e.method&&(console.log("\uD83D\uDCE4 Starting file upload process..."),(0,s.default)({multiples:!0}).parse(e,async(e,t,r)=>{if(e)return console.error("❌ Form parse error:",e),a.status(500).json({error:"Failed to parse form data",details:e.message});try{let e=r.file;if(!e)return console.error("❌ No file received in upload"),a.status(400).json({error:"No file uploaded"});console.log("\uD83D\uDCC1 Processing file:",{name:e.originalFilename,size:e.size,type:e.type});let t=`${Date.now()}-${e.originalFilename}`;console.log("\uD83D\uDE80 Uploading to Supabase Storage:",t);let{data:s,error:i}=await o.p.storage.from("images").upload(t,e.filepath,{cacheControl:"3600",upsert:!1});if(i)return console.error("❌ Supabase upload error:",i),a.status(500).json({error:"Failed to upload file to storage",details:i.message||i});console.log("✅ Upload successful, getting public URL...");let{data:{publicUrl:n}}=o.p.storage.from("images").getPublicUrl(t);console.log("\uD83D\uDD17 Public URL generated:",n),console.log("\uD83D\uDCBE Saving metadata to database...");let{data:l,error:u}=await o.p.from("media_metadata").insert({file_name:t,original_name:e.originalFilename,file_path:n,file_size:e.size,content_type:e.type,created_at:new Date().toISOString()}).select();if(u)return console.error("❌ Metadata error:",u),a.status(500).json({error:"Failed to save metadata",details:u.message||u});return console.log("✅ Complete upload success:",{fileName:t,originalName:e.originalFilename,publicUrl:n,metadataId:l?.[0]?.id}),a.status(200).json({success:!0,message:"File uploaded successfully",data:{fileName:t,originalName:e.originalFilename,publicUrl:n,metadata:l?.[0]}})}catch(e){return console.error("❌ Upload process error:",e),a.status(500).json({error:"Upload failed",details:e.message||e})}}))}catch(e){return console.error("\uD83D\uDCA5 Media API critical error:",e),a.status(500).json({error:"Internal server error",details:e.message||e})}}s=(i.then?(await i)():i)[0],r()}catch(e){r(e)}})},7153:(e,a)=>{var t;Object.defineProperty(a,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,a,t)=>{e.exports=t(145)}};var a=require("../../webpack-api-runtime.js");a.C(e);var t=a(a.s=6810);module.exports=t})();