"use strict";(()=>{var e={};e.id=3919,e.ids=[3919],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6705:e=>{e.exports=import("formidable")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,o){return o in r?r[o]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,o)):"function"==typeof r&&"default"===o?r:void 0}}})},5114:(e,r,o)=>{o.a(e,async(e,t)=>{try{o.r(r),o.d(r,{config:()=>u,default:()=>c,routeModule:()=>p});var a=o(1802),s=o(7153),n=o(6249),i=o(4323),l=e([i]);i=(l.then?(await l)():l)[0];let c=(0,n.l)(i,"default"),u=(0,n.l)(i,"config"),p=new a.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/upload-chunked",pathname:"/api/upload-chunked",bundlePath:"",filename:""},userland:i});t()}catch(e){t(e)}})},4323:(e,r,o)=>{o.a(e,async(e,t)=>{try{o.r(r),o.d(r,{config:()=>d,default:()=>p});var a=o(7147),s=o.n(a),n=o(1017),i=o.n(n),l=o(2885),c=o(6705),u=e([c]);c=(u.then?(await u)():u)[0];let d={api:{bodyParser:!1}};async function p(e,r){try{if(console.log("Chunked upload request received"),"POST"!==e.method)return console.log("Method not allowed:",e.method),r.status(405).json({error:"Method not allowed"});let o=(0,c.default)({maxFileSize:52428800,keepExtensions:!0}),[t,a]=await o.parse(e),n=a.file?.[0],u=String(t.filename?.[0]||n?.originalFilename||"").trim().replace(/[^a-zA-Z0-9._-]/g,"_");if(console.log("Processing chunked upload:",u,"Size:",n?.size),!n)return console.error("No file received"),r.status(400).json({error:"No file received"});if(n.size>52428800)return console.error("File too large:",n.size),r.status(413).json({error:"File size exceeds 50MB limit"});let p=s().readFileSync(n.filepath),d=process.env.SUPABASE_URL||"",f=process.env.SUPABASE_SERVICE_ROLE_KEY||process.env.SUPABASE_ANON_KEY||"";if(d&&f){console.log("Using Supabase storage");let e=(0,l.createClient)(d,f);try{await e.storage.createBucket("uploads",{public:!0}),console.log("Bucket created or exists")}catch(e){console.log("Bucket creation error (may already exist):",e.message)}let{error:o}=await e.storage.from("uploads").upload(u,p,{contentType:n.mimetype||"application/octet-stream",upsert:!0});if(o)return console.error("Supabase upload error:",o),r.status(500).json({error:String(o.message||o)});let t="https://rczfbgzghwiqpxihlexs.supabase.co".replace(/\/$/,"")+"/storage/v1/object/public/uploads/"+u;return console.log("Upload successful:",t),s().unlinkSync(n.filepath),r.status(200).json({path:t})}console.log("Using local filesystem storage");let g=i().join(process.cwd(),"public","uploads");try{s().existsSync(g)||(s().mkdirSync(g,{recursive:!0}),console.log("Created uploads directory:",g))}catch(e){console.error("Directory creation error:",e)}let h=i().join(g,u);return s().copyFileSync(n.filepath,h),s().unlinkSync(n.filepath),console.log("File saved locally:",h),r.status(200).json({path:"/uploads/"+u})}catch(e){console.error("Chunked upload handler error:",e),r.status(500).json({error:String(e?.message||e)})}}t()}catch(e){t(e)}})},7153:(e,r)=>{var o;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return o}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(o||(o={}))},1802:(e,r,o)=>{e.exports=o(145)}};var r=require("../../webpack-api-runtime.js");r.C(e);var o=r(r.s=5114);module.exports=o})();